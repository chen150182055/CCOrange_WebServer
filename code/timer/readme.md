# 基于小根堆实现的定时器，关闭超时的非活动连接


1. 定义定时器结构体：定义一个定时器结构体，包含定时器的过期时间、定时器回调函数等信息。可以使用`std::function`来保存回调函数。
2. 小根堆实现：利用`std::vector`或`std::array`来实现小根堆。为了方便计算左右子节点和父节点，可以采用从1开始的下标方式来实现堆。插入操作采用上浮方式，删除操作采用下沉方式。
3. 定时器管理器：定义一个定时器管理器类，用于管理定时器的添加、删除和检查。定时器管理器类中包含一个小根堆和一个时间轮。每个时间轮上包含一组小根堆，每个小根堆表示一组时间间隔。定时器管理器每隔一个时间间隔，就会检查一次对应的小根堆，如果有定时器超时，就会执行回调函数。
4. 多线程安全：为了实现多线程安全，定时器管理器类需要使用互斥量来保护小根堆的操作。同时，在定时器的回调函数中也需要使用互斥量来保护数据的访问。可以使用C++11的`std::mutex`和`std::lock_guard`来实现互斥量和自动加锁。

使用小根堆实现定时器的主要特点如下：

1. 时间复杂度为 O(logN)：小根堆可以实现 O(logN) 的时间复杂度来进行添加、删除等操作，比较高效。
2. 自动排序：小根堆是一种自动排序的数据结构，每次添加或删除元素时都会自动调整堆结构，确保堆顶元素为堆中最小值，非常适合定时器场景。
3. 空间复杂度较低：小根堆只需要保存节点和一些额外的元数据，不需要像红黑树等数据结构那样维护复杂的节点结构，因此空间复杂度相对较低。
4. 算法实现简单：小根堆的实现比较简单，容易理解和实现，常用的 STL 容器 std::p